<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>WebSocket Sniffer æ¸¬è©¦é é¢</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f5f5f5;
      padding: 40px;
      color: #333;
    }
    h1 { margin-bottom: 8px; }
    .subtitle { color: #666; margin-bottom: 24px; }
    .card {
      background: #fff;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .card h2 { font-size: 16px; margin-bottom: 12px; }
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 600;
    }
    .status.connected { background: #e8f5e9; color: #2e7d32; }
    .status.disconnected { background: #ffebee; color: #c62828; }
    .status.connecting { background: #fff3e0; color: #e65100; }
    .btn-group { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px; }
    button {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      transition: opacity 0.2s;
    }
    button:hover { opacity: 0.85; }
    button:disabled { opacity: 0.4; cursor: not-allowed; }
    .btn-connect { background: #4caf50; color: #fff; }
    .btn-disconnect { background: #f44336; color: #fff; }
    .btn-send { background: #2196f3; color: #fff; }
    .btn-send-xml { background: #ff9800; color: #fff; }
    .btn-send-text { background: #9c27b0; color: #fff; }
    .log {
      background: #1e1e1e;
      color: #d4d4d4;
      font-family: 'Menlo', monospace;
      font-size: 12px;
      padding: 16px;
      border-radius: 6px;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 12px;
      line-height: 1.6;
    }
    .log .send { color: #f44747; }
    .log .recv { color: #6a9955; }
    .log .info { color: #569cd6; }
    .log .error { color: #f44747; font-weight: bold; }
    .instructions {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 16px;
      border-radius: 0 8px 8px 0;
      margin-bottom: 24px;
      line-height: 1.8;
    }
    .instructions code {
      background: #bbdefb;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 13px;
    }
  </style>
</head>
<body>

  <h1>WebSocket Sniffer - æ¸¬è©¦é é¢</h1>
  <p class="subtitle">ç”¨é€™å€‹é é¢ä¾†é©—è­‰æ“´å……åŠŸèƒ½æ˜¯å¦æ­£ç¢ºæ””æˆª WebSocket è³‡æ–™</p>

  <div class="instructions">
    <strong>æ¸¬è©¦æ­¥é©Ÿï¼š</strong><br>
    1. å…ˆåˆ° <code>chrome://extensions/</code> è¼‰å…¥ <code>websocket-sniffer</code> è³‡æ–™å¤¾<br>
    2. å›åˆ°æ­¤é é¢ï¼ŒæŒ‰ <code>F12</code> é–‹å•Ÿé–‹ç™¼è€…å·¥å…·<br>
    3. æ‰¾åˆ° <strong>ã€ŒWebSocket Snifferã€</strong> åˆ†é <br>
    4. é»ä¸‹æ–¹çš„ã€Œé€£ç·šã€æŒ‰éˆ•ï¼Œè§€å¯Ÿé¢æ¿æ˜¯å¦æœ‰æ””æˆªåˆ°è³‡æ–™
  </div>

  <!-- é€£ç·šæ§åˆ¶ -->
  <div class="card">
    <h2>é€£ç·šæ§åˆ¶</h2>
    <span class="status disconnected" id="status">æœªé€£ç·š</span>
    <div class="btn-group">
      <button class="btn-connect" id="btn-connect" onclick="doConnect()">é€£ç·š</button>
      <button class="btn-disconnect" id="btn-disconnect" onclick="doDisconnect()" disabled>æ–·ç·š</button>
    </div>
  </div>

  <!-- ç™¼é€è³‡æ–™ -->
  <div class="card">
    <h2>ç™¼é€æ¸¬è©¦è³‡æ–™</h2>
    <div class="btn-group">
      <button class="btn-send" id="btn-json" onclick="sendJson()" disabled>
        ç™¼é€ JSON
      </button>
      <button class="btn-send-xml" id="btn-xml" onclick="sendXml()" disabled>
        ç™¼é€ XML
      </button>
      <button class="btn-send-text" id="btn-text" onclick="sendText()" disabled>
        ç™¼é€ç´”æ–‡å­—
      </button>
    </div>
  </div>

  <!-- æ—¥èªŒ -->
  <div class="card">
    <h2>é é¢æ—¥èªŒ</h2>
    <div class="log" id="log"></div>
  </div>

<script>
  let ws = null;
  const logEl = document.getElementById('log');
  const statusEl = document.getElementById('status');

  function log(type, text) {
    const line = document.createElement('div');
    line.className = type;
    const time = new Date().toLocaleTimeString('en-GB', { hour12: false });
    line.textContent = `[${time}] ${text}`;
    logEl.appendChild(line);
    logEl.scrollTop = logEl.scrollHeight;
  }

  function updateButtons(connected) {
    document.getElementById('btn-connect').disabled = connected;
    document.getElementById('btn-disconnect').disabled = !connected;
    document.getElementById('btn-json').disabled = !connected;
    document.getElementById('btn-xml').disabled = !connected;
    document.getElementById('btn-text').disabled = !connected;
  }

  function doConnect() {
    statusEl.textContent = 'é€£ç·šä¸­...';
    statusEl.className = 'status connecting';
    log('info', 'æ­£åœ¨é€£ç·šåˆ° ws://localhost:3210 ...');

    ws = new WebSocket('ws://localhost:3210');

    ws.onopen = () => {
      statusEl.textContent = 'å·²é€£ç·š';
      statusEl.className = 'status connected';
      updateButtons(true);
      log('info', 'âœ“ WebSocket å·²é€£ç·š');
    };

    ws.onmessage = (event) => {
      log('recv', 'â† æ”¶åˆ°: ' + event.data);
    };

    ws.onclose = (event) => {
      statusEl.textContent = 'æœªé€£ç·š';
      statusEl.className = 'status disconnected';
      updateButtons(false);
      log('info', `âœ• é€£ç·šå·²é—œé–‰ (code=${event.code})`);
      ws = null;
    };

    ws.onerror = () => {
      log('error', 'âœ• é€£ç·šéŒ¯èª¤ï¼è«‹ç¢ºèª server.js æ˜¯å¦æ­£åœ¨åŸ·è¡Œ');
    };
  }

  function doDisconnect() {
    if (ws) {
      ws.close();
      log('info', 'æ‰‹å‹•æ–·ç·š');
    }
  }

  function sendJson() {
    const data = {
      action: 'subscribe',
      channel: 'stock',
      symbols: ['AAPL', 'GOOG', 'TSLA'],
      options: { interval: '1m', depth: 5 }
    };
    ws.send(JSON.stringify(data));
    log('send', 'â†’ ç™¼é€ JSON: ' + JSON.stringify(data));
  }

  function sendXml() {
    const xml = `<?xml version="1.0" encoding="UTF-8"?>
<request>
  <action>query</action>
  <params>
    <symbol>AAPL</symbol>
    <from>2024-01-01</from>
    <to>2024-12-31</to>
  </params>
</request>`;
    ws.send(xml);
    log('send', 'â†’ ç™¼é€ XML: ' + xml.replace(/\n/g, ' ').substring(0, 80) + '...');
  }

  function sendText() {
    const text = 'Hello WebSocket! é€™æ˜¯ä¸€æ®µç´”æ–‡å­—æ¸¬è©¦è¨Šæ¯ ğŸš€';
    ws.send(text);
    log('send', 'â†’ ç™¼é€ç´”æ–‡å­—: ' + text);
  }
</script>

</body>
</html>
